<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link href="/main.css" rel="stylesheet">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>
<body>
<div th:replace="~{ nav.html::navbar }"></div>
    <div class="card" th:each="i : ${items}">
        <img src="https://placehold.co/300">
        <div>
            <a th:href="@{/detail/{id}(id=${i.id})}"><h4 th:text="${i.title}"></h4></a>
            <p th:text="${i.price + '원'}"></p>
<!--            <a th:href="@{/edit/{id}(id=${i.id})}">✏️</a>-->
            <a th:href="@{'/edit/'+${i.id}}">✏️</a>
            <button onclick="deleteItem([[${i.id}]], this)">삭제</button>
        </div>
    </div>

    <button class="btn">버튼</button>
<script>
    document.querySelectorAll('.btn')[0].addEventListener('click',function(){
        fetch('/test1',{
        method: 'POST',
        headers : { 'Content-Type' : 'application/json'},
        body : JSON.stringify({name : 'kim'})
        })
    })


var csrfToken = document.querySelector('meta[name="_csrf"]').content;
var csrfHeader = document.querySelector('meta[name="_csrf_header"]').content;

    function deleteItem(itemId, button) {
        if (confirm('정말로 삭제하시겠습니까?')) {
            fetch('/item?id=' + itemId, { method: 'DELETE',
             headers: {
            'Content-Type': 'application/json',
            [csrfHeader]: csrfToken
                }
             })
                .then(response => {
                    if (response.ok) {
                        button.closest('.card').remove(); // 삭제한 카드 제거
                    } else {
                        alert('상품 삭제에 실패했습니다.');
                    }
                })
                .catch(error => {
                    console.error('상품 삭제 중 오류 발생:', error);
                    alert('상품 삭제 중 오류가 발생했습니다.');
                });
        }
    }
</script>

</body>
</html>